import{_ as A,a as c,r as m,o,c as i,b as t,t as d,d as y,w as f,e as h,v as _,f as g,n as q,g as k,h as p,i as v,j as C,F as x,k as B}from"./index-423b4fec.js";const D={emits:["delete-answer"],name:"AnswerComponent",props:{answer:{type:Object,required:!0},requestUser:{type:String,required:!0}},data(){return{userLikedAnswer:this.answer.user_has_liked_answer,likesCounter:this.answer.likes_count,showDeleteConfirmationButton:!1}},computed:{isAnswerAuthor(){return this.answer.author===this.requestUser}},methods:{triggerDeleteAnswer(){this.$emit("delete-answer",this.answer)},toggleLike(){this.userLikedAnswer===!1?this.likeAnswer():this.unlikeAnswer()},async likeAnswer(){this.userLikedAnswer=!0,this.likesCounter+=1;const n=`/api/v1/answers/${this.answer.uuid}/like/`;try{await c.post(n)}catch(e){console.log(e)}},async unlikeAnswer(){this.userLikedAnswer=!1,this.likesCounter-=1;const n=`/api/v1/answers/${this.answer.uuid}/like/`;try{await c.delete(n)}catch(e){console.log(e)}}}},Q={class:"text-muted"},L={style:{"white-space":"pre-wrap"}},S={key:0},U={key:1},F={class:"badge bg-danger"},H=t("hr",null,null,-1);function N(n,e,u,b,s,r){const w=m("router-link");return o(),i("div",null,[t("p",Q,[t("strong",null,d(u.answer.author)+" â‹…"+d(u.answer.created_at),1)]),t("p",L,d(u.answer.body),1),r.isAnswerAuthor?(o(),i("div",S,[y(w,{class:"btn btn-sm btn-warning",to:{name:"answer-editor",params:{uuid:u.answer.uuid}}},{default:f(()=>[g(" Edit ")]),_:1},8,["to"]),t("button",{onClick:e[0]||(e[0]=a=>s.showDeleteConfirmationButton=!s.showDeleteConfirmationButton),class:"btn btn-sm btn-danger mx-1"}," Delete "),h(t("button",{onClick:e[1]||(e[1]=(...a)=>r.triggerDeleteAnswer&&r.triggerDeleteAnswer(...a)),class:"btn btn-sm btn-outline-danger"}," Yes, delete my answer ",512),[[_,s.showDeleteConfirmationButton]])])):(o(),i("div",U,[t("button",{onClick:e[2]||(e[2]=(...a)=>r.toggleLike&&r.toggleLike(...a)),class:q(["btn",{"btn-warning":s.userLikedAnswer,"btn-outline-danger":!s.userLikedAnswer}])},[g(d(s.userLikedAnswer?"Unlike answer":"Like answer")+" ",1),t("span",F,d(s.likesCounter),1)],2)])),H])}const T=A(D,[["render",N]]),V={name:"QuestionActions",props:{slug:{type:String,required:!0}},data(){return{showDeleteConfirmationButton:!1}},methods:{async deleteQuestion(){const n=`/api/v1/questions/${this.slug}/`;try{await c.delete(n),this.$router.push({name:"home"})}catch(e){console.log(e)}}}},P={class:"mt-2"},E=t("hr",null,null,-1);function Y(n,e,u,b,s,r){const w=m("router-link");return o(),i("div",P,[y(w,{to:{name:"question-editor",params:{slug:u.slug}},class:"btn btn-sm btn-warning me-1"},{default:f(()=>[g(" Edit ")]),_:1},8,["to"]),t("button",{onClick:e[0]||(e[0]=a=>s.showDeleteConfirmationButton=!s.showDeleteConfirmationButton),class:"btn btn-sm btn-danger mx-1"},"Delete"),h(t("button",{onClick:e[1]||(e[1]=(...a)=>r.deleteQuestion&&r.deleteQuestion(...a)),class:"btn btn-sm btn-outline-danger"},"Yes, delete my question",512),[[_,s.showDeleteConfirmationButton]]),E])}const j=A(V,[["render",Y]]);const M={name:"Question",components:{AnswerComponent:T,QuestionActions:j},props:{slug:{type:String,required:!0}},data(){return{question:null,answers:[],next:null,loadingAnswers:!1,userHasAnswered:!1,showForm:!1,newAnswerBody:null,error:null,requestUser:null}},computed:{isQuestionAthor(){return this.question.author===this.requestUser}},methods:{setRequestUser(){this.requestUser=window.localStorage.getItem("username")},cancelAnswer(){this.showForm=!1,this.newAnswerBody=null},setPageTitle(n){document.title=n},async getQuestionData(){const n=`/api/v1/questions/${this.slug}/`;try{const e=await c.get(n);this.question=e.data,this.userHasAnswered=e.data.user_has_answered,this.setPageTitle(e.data.content)}catch{const u="404 - Not found";this.setPageTitle(u)}},async getQuestionAnswers(){let n=`/api/v1/questions/${this.slug}/answers/`;this.next&&(n=this.next),this.loadingAnswers=!0;try{const e=await c.get(n);this.answers.push(...e.data.results),this.loadingAnswers=!1,e.data.next?this.next=e.data.next:this.next=null}catch(e){console.log(e)}},async onSubmit(){if(!this.newAnswerBody){this.error="Can't send an empty answer";return}const n=`/api/v1/questions/${this.slug}/answer/`;try{const e=await c.post(n,{body:this.newAnswerBody});this.answers.unshift(e.data),this.newAnswerBody=null,this.showForm=!1,this.userHasAnswered=!0,this.error&&(this.error=null)}catch(e){console.log(e)}},async deleteAnswer(n){const e=`/api/v1/answers/${n.uuid}/`;try{await c.delete(e),this.answers.splice(this.answers.indexOf(n),1),this.userHasAnswered=!1}catch(u){console.log(u)}}},created(){this.getQuestionData(),this.getQuestionAnswers(),this.setRequestUser()}},O={class:"container mt-3"},R={key:0},z={class:"mb-0"},I={class:"author-name"},G={key:1,class:"answer-added"},J={key:2},K=t("p",null,"Answer the question",-1),W=t("button",{type:"submit",class:"btn btn-success my-3"},"Submit your answer",-1),X={key:0,class:"error mt-2"},Z={key:3},$=t("hr",null,null,-1),ee={key:1},se=t("h1",{class:"error text-center"},"404 - Question not found!",-1),te=[se],ne={key:2},re={class:"my-4"};function oe(n,e,u,b,s,r){const w=m("QuestionActions"),a=m("AnswerComponent");return o(),i("div",O,[s.question?(o(),i("div",R,[t("h1",null,d(s.question.content),1),t("p",z,[g("Posted by: "),t("span",I,d(s.question.author),1)]),t("p",null,"Created: "+d(s.question.created_at),1),r.isQuestionAthor?(o(),k(w,{key:0,slug:s.question.slug},null,8,["slug"])):p("",!0),s.userHasAnswered?(o(),i("div",G," You've already answered this question! ")):s.showForm?(o(),i("div",J,[t("form",{onSubmit:e[2]||(e[2]=C((...l)=>r.onSubmit&&r.onSubmit(...l),["prevent"]))},[K,h(t("textarea",{"onUpdate:modelValue":e[0]||(e[0]=l=>s.newAnswerBody=l),class:"form-control",placeholder:"Share your knowledge",rows:"10"},null,512),[[v,s.newAnswerBody]]),W,t("button",{class:"btn btn-danger pl-3",onClick:e[1]||(e[1]=(...l)=>r.cancelAnswer&&r.cancelAnswer(...l))},"Cancel")],32),s.error?(o(),i("p",X,d(s.error),1)):p("",!0)])):(o(),i("div",Z,[t("button",{class:"btn btn-success",onClick:e[3]||(e[3]=l=>s.showForm=!0)},"Answer the question")])),$])):(o(),i("div",ee,te)),s.question?(o(),i("div",ne,[(o(!0),i(x,null,B(s.answers,l=>(o(),k(a,{key:l.uuid,answer:l,requestUser:s.requestUser,onDeleteAnswer:r.deleteAnswer},null,8,["answer","requestUser","onDeleteAnswer"]))),128))])):p("",!0),t("div",re,[h(t("p",null,".. loading questions ..",512),[[_,s.loadingAnswers]]),h(t("button",{onClick:e[4]||(e[4]=(...l)=>r.getQuestionAnswers&&r.getQuestionAnswers(...l)),class:"btn btn-sm btn-outline-success"}," Load more ",512),[[_,s.next]])])])}const ue=A(M,[["render",oe]]);export{ue as default};
